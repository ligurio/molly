<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Molly documentation</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>molly</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Functions">Functions</a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/molly.client.html">molly.client</a></li>
  <li><a href="../modules/molly.thread_coroutine.html">molly.thread_coroutine</a></li>
  <li><a href="../modules/molly.thread_fiber.html">molly.thread_fiber</a></li>
  <li><a href="../modules/molly.db.html">molly.db</a></li>
  <li><a href="../modules/molly.gen.html">molly.gen</a></li>
  <li><a href="../modules/molly.history.html">molly.history</a></li>
  <li><a href="../modules/molly.html">molly</a></li>
  <li><a href="../modules/molly.log.html">molly.log</a></li>
  <li><a href="../modules/molly.nemesis.html">molly.nemesis</a></li>
  <li><a href="../modules/molly.op.html">molly.op</a></li>
  <li><a href="../modules/molly.runner.html">molly.runner</a></li>
  <li><strong>molly.tests</strong></li>
  <li><a href="../modules/molly.thread.html">molly.thread</a></li>
  <li><a href="../modules/molly.utils.html">molly.utils</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/README.md.html">README</a></li>
</ul>
<h2>Examples</h2>
<ul class="nowrap">
  <li><a href="../examples/sqlite-rw-register.lua.html">sqlite-rw-register.lua</a></li>
  <li><a href="../examples/sqlite-list-append.lua.html">sqlite-list-append.lua</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>molly.tests</code></h1>
<p>Module with test generators and checkers.</p>
<p>


<h3>List-Append</h3>

<p> list-append operations are either appends or reads</p>

<p> Detects cycles in histories where operations are transactions over named
 lists lists, and operations are either appends or reads.</p>

<p> The <em>append</em> test models the database as a collection of named lists,
 and performs transactions comprised of read and append operations. A
 read returns the value of a particular list, and an append adds a single
 unique element to the end of a particular list. We derive ordering
 dependencies between these transactions, and search for cycles in that
 dependency graph to identify consistency anomalies.</p>

<p> In terms of Molly, values in operation are lists of integers. Each operation
 performs a transaction, comprised of micro-operations which are either reads
 of some value (returning the entire list) or appends (adding a single number
 to whatever the present value of the given list is). We detect cycles in
 these transactions using Elle's cycle-detection system.</p>

<p> Generator <a href="../modules/molly.tests.html#list_append_gen">molly.tests.list_append_gen</a> produces an operations
 compatible with Molly:</p>


<pre>
{ index = <span class="number">2</span>, <span class="global">type</span> = <span class="string">"invoke"</span>, value = {{ <span class="string">"append"</span>, <span class="number">255</span>, <span class="number">8</span> } { <span class="string">"r"</span>, <span class="number">253</span>, null }}}
{ index = <span class="number">3</span>, <span class="global">type</span> = <span class="string">"ok"</span>,     value = {{ <span class="string">"append"</span>, <span class="number">255</span>, <span class="number">8</span> } { <span class="string">"r"</span>, <span class="number">253</span>, { <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span> }}}}
{ index = <span class="number">4</span>, <span class="global">type</span> = <span class="string">"invoke"</span>, value = {{ <span class="string">"append"</span>, <span class="number">256</span>, <span class="number">4</span> } { <span class="string">"r"</span>, <span class="number">255</span>, null } { <span class="string">"r"</span>, <span class="number">256</span>, <span class="keyword">nil</span> } { <span class="string">"r"</span>, <span class="number">253</span>, null }}}
{ index = <span class="number">5</span>, <span class="global">type</span> = <span class="string">"ok"</span>,     value = {{ <span class="string">"append"</span>, <span class="number">256</span>, <span class="number">4</span> } { <span class="string">"r"</span>, <span class="number">255</span>, { <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">8</span> }} { <span class="string">"r"</span>, <span class="number">256</span>, { <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span> }} {{ <span class="string">"r"</span>, <span class="number">253</span>, { <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span> }}}}
{ index = <span class="number">6</span>, <span class="global">type</span> = <span class="string">"invoke"</span>, value = {{ <span class="string">"append"</span>, <span class="number">250</span>, <span class="number">10</span> } { <span class="string">"r"</span>, <span class="number">253</span>, null }{ <span class="string">"r"</span>, <span class="number">255</span>, null } { <span class="string">"append"</span>, <span class="number">256</span>, <span class="number">3</span> }}}
</pre>

<p> A partial test, including a generator and checker. You'll need to provide a
 client which can understand operations of the form:</p>


<pre>
{ <span class="global">type</span> = <span class="string">"invoke"</span>, f = <span class="string">"txn"</span>, value = {{ <span class="string">"r"</span>, <span class="number">3</span>, null } { <span class="string">"append"</span>, <span class="number">3</span>, <span class="number">2</span> } { <span class="string">"r"</span>, <span class="number">3</span>, null }}}
</pre>

<p> and return completions like:</p>


<pre>
{ <span class="global">type</span> = <span class="string">"invoke"</span>, f = <span class="string">"txn"</span>, value = {{ <span class="string">"r"</span>, <span class="number">3</span>, { <span class="number">1</span> }} { <span class="string">"append"</span>, <span class="number">3</span>, <span class="number">2</span> } { <span class="string">"r"</span>, <span class="number">3</span>, { <span class="number">1</span>, <span class="number">2</span> }}}}
</pre>

<p> where the key <code>3</code> identifies some list, whose value is initially <code>[1]</code>, and
 becomes <code>[1 2]</code>.</p>

<p> Lists are encoded as rows in a table; key names are table names, and the set
 of all rows determines the list contents.</p>

<p> This test requires a way to order table contents.</p>

<h3>RW Register</h3>

<p> Generator produces concurrent atomic updates to a shared register. Writes
 are assumed to be unique, but this is the only constraint.</p>

<p> Operations are of two forms:</p>


<pre>
{ <span class="string">"r"</span>, <span class="string">"x"</span>, <span class="number">1</span> } denotes a read of <span class="backtick"><code>x</code></span> observing the value <span class="number">1.</span>
{ <span class="string">"w"</span>, <span class="string">"x"</span>, <span class="number">2</span> } denotes a write of <span class="backtick"><code>x</code></span>, settings its value to <span class="number">2.</span>
</pre>

<p> Example of history:</p>


<pre>
{ <span class="global">type</span> = <span class="string">"invoke"</span>, f = <span class="string">"txn"</span>, value = {{ <span class="string">"w"</span>, <span class="string">"x"</span>, <span class="number">1</span> }},   process = <span class="number">0</span>, index = <span class="number">1</span>}
{ <span class="global">type</span> = <span class="string">"ok"</span>,     f = <span class="string">"txn"</span>, value = {{ <span class="string">"w"</span>, <span class="string">"x"</span>, <span class="number">1</span> }},   process = <span class="number">0</span>, index = <span class="number">2</span>}
{ <span class="global">type</span> = <span class="string">"invoke"</span>, f = <span class="string">"txn"</span>, value = {{ <span class="string">"r"</span>, <span class="string">"x"</span>, null }}, process = <span class="number">0</span>, index = <span class="number">3</span>}
{ <span class="global">type</span> = <span class="string">"ok"</span>,     f = <span class="string">"txn"</span>, value = {{ <span class="string">"r"</span>, <span class="string">"x"</span>, <span class="number">2</span> }},   process = <span class="number">0</span>, index = <span class="number">4</span>}
</pre>

<p> Note that in Lua associative array is an array that can be indexed not only
 with numbers, but also with strings or any other value of the language,
 except nil. Null values in Lua tables are represented as JSON null
 (<code>json.NULL</code>, a Lua <code>lightuserdata</code> NULL pointer). is provided for
 comparison.</p>
</p>


<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#rw_register_gen">rw_register_gen ()</a></td>
	<td class="summary">Write/Read operations generator.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#list_append_gen">list_append_gen ([opts])</a></td>
	<td class="summary">List-Append operations generator.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "rw_register_gen"></a>
    <strong>rw_register_gen ()</strong>
    </dt>
    <dd>
    Write/Read operations generator.



    <h3>Returns:</h3>
    <ol>

        an iterator
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">&gt; log = <span class="global">require</span>(<span class="string">'log'</span>)
&gt; tests = <span class="global">require</span>(<span class="string">'molly.tests'</span>)
&gt; <span class="keyword">for</span> _it, v <span class="keyword">in</span> tests.rw_register_gen() <span class="keyword">do</span> log.info(v()) <span class="keyword">end</span>
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r","x",null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["w","x",58]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r","x",null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["w","x",80]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r","x",null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["w","x",46]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r","x",null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["w","x",19]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r","x",null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["w","x",66]]</span>}
<span class="comment">---
</span>...</pre>
    </ul>

</dd>
    <dt>
    <a name = "list_append_gen"></a>
    <strong>list_append_gen ([opts])</strong>
    </dt>
    <dd>
    List-Append operations generator. </p>

<p> A generator for operations where values are transactions made up of reads
 and appends to various integer keys.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">opts</span> Table with options.
        <ul>
        <li><span class="parameter">key_count</span>
            <span class="types"><span class="type">number</span></span>
         Number of distinct keys at any point. Default is
 3.
         (<em>optional</em>)
        </li>
        <li><span class="parameter">min_txn_len</span>
            <span class="types"><span class="type">number</span></span>
         Minimum number of operations per txn. Default
 is 1.
         (<em>optional</em>)
        </li>
        <li><span class="parameter">max_txn_len</span>
            <span class="types"><span class="type">number</span></span>
         Maximum number of operations per txn. Default
 is 2.
         (<em>optional</em>)
        </li>
        <li><span class="parameter">max_writes_per_key</span>
            <span class="types"><span class="type">number</span></span>
         Maximum number of operations per key.
 Default is 32.
         (<em>optional</em>)
        </li>
        </li></ul>
    </ul>

    <h3>Returns:</h3>
    <ol>

        an iterator
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">&gt; log = <span class="global">require</span>(<span class="string">'log'</span>)
&gt; tests = <span class="global">require</span>(<span class="string">'molly.tests'</span>)
&gt; <span class="keyword">for</span> _it, v <span class="keyword">in</span> tests.list_append_gen() <span class="keyword">do</span> log.info(v()) <span class="keyword">end</span>
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r",3,null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["append",3,1]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r",2,null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["append",3,2]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r",1,null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["append",2,3]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r",2,null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["append",3,4]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["r",2,null]]</span>}
{<span class="string">"f"</span>:<span class="string">"txn"</span>,<span class="string">"value"</span>:<span class="string">[["append",2,5]]</span>}
<span class="comment">---
</span>...</pre>
    </ul>

</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2022-06-27 10:45:07 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
